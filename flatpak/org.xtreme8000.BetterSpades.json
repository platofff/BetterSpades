{
  "app-id": "org.xtreme8000.BetterSpades",
  "runtime": "org.freedesktop.Platform",
  "runtime-version": "20.08",
  "sdk": "org.freedesktop.Sdk",
  "command": "/app/start.sh",
  "finish-args": [
    "--share=ipc",
    "--socket=x11",
    "--socket=pulseaudio",
    "--socket=wayland",
    "--share=network",
    "--device=dri",
    "--extension=org.freedesktop.Platform.GL=directory=lib/GL",
    "--filesystem=xdg-cache",
    "--filesystem=xdg-config"
  ],
  "cleanup": [
    "/include",
    "/lib/pkgconfig"
  ],
  "modules": [
    "shared-modules/glu/glu-9.json",
    "shared-modules/glew/glew.json",
    {
      "name": "glfw",
      "buildsystem": "cmake",
      "config-opts": [
        "-DBUILD_SHARED_LIBS=ON"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/glfw/glfw",
          "tag": "3.3.2"
        }
      ]
    },
    {
      "name": "openal-soft",
      "buildsystem": "cmake",
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/kcat/openal-soft",
          "tag": "openal-soft-1.21.0"
        }
      ]
    },
    {
      "name": "enet",
      "buildsystem": "simple",
      "build-commands": [
        "autoreconf -vfi",
        "./configure --prefix=/app",
        "make -j",
        "make install"      
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/lsalzman/enet",
          "tag": "v1.3.16"
        }
      ]
    },
    {
      "name": "libdeflate",
      "buildsystem": "simple",
      "build-commands": [
        "make -j",
        "make PREFIX=/app install"   
      ],      
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/ebiggers/libdeflate",
          "tag": "v1.7"
        }
      ]
    },
    {
      "name": "BetterSpades",
      "buildsystem": "cmake",
      "build-options": {
        "build-args": [
          "--share=network"
        ]
      },
      "no-make-install": true,
      "post-install": [
        "mv build/BetterSpades/* /app/",
        "mv /app/config.ini /app/config.ini.initial",
        "ln -s /run/config.ini /app/config.ini",
        "rm -r /app/cache",
        "ln -s /run/cache /app/cache",
        "echo '#!/bin/sh\nmkdir -p $XDG_CACHE_HOME/org.xtreme8000.BetterSpades\nmkdir -p $XDG_CONFIG_HOME/org.xtreme8000.BetterSpades\nln -s $XDG_CONFIG_HOME/org.xtreme8000.BetterSpades/config.ini /run/config.ini\nln -s $XDG_CACHE_HOME/org.xtreme8000.BetterSpades /run/cache\n[ ! -f $XDG_CONFIG_HOME/org.xtreme8000.BetterSpades/config.ini ] && cp /app/config.ini.initial $XDG_CONFIG_HOME/org.xtreme8000.BetterSpades/config.ini\ncd /app\n/app/client $@' > /app/start.sh",
        "chmod +x /app/start.sh"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/xtreme8000/BetterSpades",
          "branch": "standalone"
        }
      ]
    }
  ]
}
